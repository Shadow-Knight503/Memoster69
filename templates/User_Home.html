{% load materializecss %}
{% load static %}
{% load Filters %}

<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-alpha.2/css/materialize.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-alpha.2/js/materialize.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="{% static "css/style_home.css" %}">
    <title>Home</title>
</head>
<style>
    :root{
        --NavBack    : {{ theme.Nav_Back }};
        --NavColor   : {{ theme.Nav_Color }};
        --NavLine    : {{ theme.Nav_Line }};
        --CardBack   : {{ theme.Card_Back }};
        --CardColor  : {{ theme.Card_Color }};
        --CardBorder : {{ theme.Card_Border }};
        --BodyBack   : {{ theme.Body_Back }};
    }
    body {
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        position: relative;
        color: white;
        background: var(--BodyBack);
    }
    .nav-wrapper{
        background: var(--NavBack);
        border-bottom: 2px solid var(--NavLine);
        color: var(--NavColor);
    }
     #Navcons{
        color: var(--NavColor);
    }
    .Nav_Words{
        color: var(--NavColor);
    }
    .card {
        border: 2px solid var(--CardBorder);
        background: var(--CardBack);
        color: var(--CardColor);
        border-radius: 1%;
    }
    .card-reveal{
        color: var(--CardColor);
        flood-color: blue;
    }
    .profiles {
        height: 25px;
        width: 25px;
        border-radius: 25px;
    }
    .OP {
        color: var(--CardColor);
        font-size: 25px;
    }
    #Title{
        color: var(--CardColor);
        {% comment %} Nice {% endcomment %}
    }
    #Cardcons{
        color: var(--CardColor);
    }
    .Cardcons{
        color: var(--CardColor);
    }
    button {
        border-radius: 50px;
    }
    .card-header {
        position: -webkit-sticky;
        position: sticky;
        top: -1px;
        border-radius: 25px;
        height: 45px;
        padding-left: 10px;
        padding-right: 10px;
        padding-top: 5px;
    }
    .comment_builder textarea {
        width: 100%;
        height: 150px;
        padding: 12px 20px;
        box-sizing: border-box;
        border: 2px solid navy;
        border-radius: 4px;
        background-color: #f8f8f8;
        font-size: 16px;
        resize: none;
    }
    .collection .collection-item {
        background-color: black;
        border-color: navy;
    }
    #SideStuff{
        float: right;
        width: 400px;
        right: 50px;
        position: -webkit-sticky;
        position: sticky;
        top: 0;
    }
    .card-header{
        background: var(--CardBack);
        position: -webkit-sticky;
        position: sticky;
        top: 0;
        z-index:100;
    }
    .Vid {
        display: inline-block;
        position: relative;
        align-content: center;
        overflow: hidden;
        z-index: 5;
    }
    .Video {
        position: relative;
    }
    .Middle_Menu {
        position: absolute;
        alignment: center;
        left: 32%;
        top: 28%;
    }
    .Bottom_Menu {
        position: absolute;
        width: 100%;
        left: 0;
        bottom: 0;
    }
    .material-icons:hover {
        cursor: pointer;
    }
    .Ply_Pau {
        padding-top: 15%;
    }
    .Play {
        display: block;
    }
    .Pause {
        display: none;
    }
    progress {
        margin-top: 1%;
        background-color: steelblue;
        border-radius: 15px;
    }
    progress[value]::-webkit-progress-bar {
        color: lightseagreen;
    }
    progress[value]::-webkit-progress-value {
        background-color: lightseagreen;
    }
    .Fst_Fwd, .Fst_Rwd {
        text-indent: -1%;
    }
    svg {
        overflow: visible;
    }
    path {
        stroke-dashoffset: 0;
        stroke-dasharray: 1550;
        transform-origin: center;
    }
    .upvote:hover path {
        animation: stroke-animation 1.75s ease-in-out forwards;
    }
    .upvote_back {
        position: absolute;
        bottom: 25%;
        right: 45%;
    }
    .animate_Upvote{
        animation: Upvote 1.25s ease-out forwards;
    }
    .animate_Downvote{
        animation: Downvote 1.25s ease-out forwards;
    }
    @keyframes Downvote {
        0% {
            fill: steelblue;
            transform: translateY(-50%) scale(2) rotate(-180deg);
            opacity: 0.5;
        }
        30%{
            transform: scale(3);
        }
        60% {
            transform: translateY(100%) scale(5);
            opacity: 0.75;
        }
        70% {
            opacity: 0.75;
        }
        100%{
            transform: scale(2);
            opacity: 0;
        }
    }
    @keyframes Upvote {
        0% {
            fill: orangered;
            transform: translateY(50%) scale(2) rotate(180deg);
            opacity: 0.5;
        }
        30%{
            transform: scale(3);
        }
        60% {
            transform: translateY(-100%) scale(5);
            opacity: 0.75;
        }
        70% {
            opacity: 0.75;
        }
        100%{
            transform: scale(2);
            opacity: 0;
        }
    }
    @keyframes stroke-animation {
        0% {
            stroke-dashoffset: 0;
        }
        30% {
            stroke-dashoffset: 1550;
            stroke: orangered;
        }
        60% {
            stroke-dashoffset: 3100;
            fill: transparent;
            stroke: red;
            transform: scale(1);
        }
        80% {
            transform: scale(1.3);
        }
        90% {
            transform: scale(1);
        }
        100% {
            stroke-dashoffset: 3100;
            stroke: orangered;
        }
    }
</style>
<body>
{% include 'Navbar.html' %}
    <div class="card" id="SideStuff">
        <div class="card-content white-text">
            <span class="card-title">Side Stuff</span>
            <p>Don't Know what to put here yet,
                thinking about putting Credits Or Awards</p>
        </div>
    </div>
    <div class="container">
        {% for Meme, prpty in posts.items %}
            <div class="card" style="width: 669px;
                {% if Meme.Pinned == True %}
                    border: 3px solid gold;
                {% elif prpty|get_index:"0" == 1 %}
                    border: 3px solid orangered;
                {% elif prpty|get_index:"1" == 1 %}
                    border: 3px solid steelblue;
                {% endif %}
                " id="Meme{{ Meme.id }}">
                <div class="card-image" style="position: relative">
                    {% if Meme.Type == 'Img' %}
                    <img src="{{ Meme.Post.url }}" alt="{{ Meme.Title }}" class="Img" id="Img_{{ Meme.id }}"
                         style="display: block;width: 100%;height: 100%;object-fit:cover;"
                         onclick="">
                    {% elif Meme.Type == 'Gif' %}
                    <img src="{{ Static_Gif }}" alt="{{ Meme.Title }}" class="Gif" id="Gif_{{ Meme.id }}"
                         style="display: block;width: 100%;height: 100%;object-fit:cover;border-radius: 5px"
                         onclick="PlayGif('{{ Meme.id }}', '{{ Meme.Post.url }}')" name="{{ Meme.Post.url }}">
                    {% elif Meme.Type == 'Vid' %}
                    <div class="Vid" id="Vid_{{ Meme.id }}">
                        <video src="{{ Meme.Post.url }}" height="500px" width="500px" id="Video_{{ Meme.id }}"
                               style="display: block;width: 100%;height: 100%;object-fit:cover;" class="Video"></video>
                        <div class="Middle_Menu" id="Middle_Menu_{{ Meme.id }}" onclick="Play({{ Meme.id }})">
                            <span class="Fst_Rwd"><i class="material-icons medium" onclick="Rewind({{ Meme.id }})">
                                fast_rewind</i></span>
                            <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" width="110px" height="110px"
                                 class="Ply_Pau" onclick="Play({{ Meme.id }});this.onclick=null;">
                                <circle r="45" cx="50" cy="50" fill="none" stroke="lightblue" stroke-width="2">
                                </circle>
                                <path d="M 84 50 l -49 -31 v 62 l 49 -31" stroke="lightblue" fill="lightblue"
                                      id="Play_{{ Meme.id }}" class="Play">
                                </path>
                                <path d="M 69 19 h -12 v 62 h 12 v -62 M 44 19 h -12 v 62 h 12 v -62" stroke="lightblue"
                                      id="Pause_{{ Meme.id }}" class="Pause" fill="lightblue">
                                </path>
                            </svg>
                            <span class="Fst_Fwd"><i class="material-icons medium" onclick="Forward({{ Meme.id }})">
                                fast_forward</i></span>
                        </div>
                        <div class="Bottom_Menu row" id="Bottom_Menu_{{ Meme.id }}">
                            <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" width="30px" height="30px"
                                 class="Ply_Pau col s1" onclick="Play({{ Meme.id }})" id="Ply_Pau_{{ Meme.id }}">
                                <path d="M 84 50 l -49 -31 v 62 l 49 -31" stroke="lightblue" fill="lightblue"
                                      id="Play_Nav_{{ Meme.id }}" class="Play" style="display: block">
                                </path>
                                <path d="M 69 19 h -12 v 62 h 12 v -62 M 44 19 h -12 v 62 h 12 v -62" stroke="lightblue"
                                      id="Pause_Nav_{{ Meme.id }}" class="Pause" fill="lightblue">
                                </path>
                            </svg>
                            <progress class="Progress col s8" id="Progress_{{ Meme.id }}" max="100" value="0">
                                Progress</progress>
                            <label for="Src_Getter_{{ Meme.id }}"></label>
                            <input id="Src_Getter_{{ Meme.id }}" value="{{ Meme.Post.url }}"
                                   style="display: none" type="text">
                            <i class="material-icons small col s1" onclick="LinkCopy({{ Meme.id }})">link</i>
                            <a href="{{ Meme.Post.url|attach }}" target="_blank" download>
                                <i class="Dwld material-icons small col s1">file_download</i></a>
                            <i class="Full_Scrn material-icons small col s1" onclick="Full_Scrn({{ Meme.id }})">
                                fullscreen</i>
                        </div>
                    </div>
                    {% endif %}
                    <div id="Upvote_back{{ Meme.id }}" class="Upvote_back" style="position: absolute;bottom: 25%;right: 45%;">
                        <svg class="" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" width="100"
                             height="100" >
                            <path d="M 49.4 8.5 l 25.8 30 h -15 v 46 h -20 v -46 h -15 l 26 -30" fill="transparent"
                                  stroke-width="3" id="Upvote_move{{ Meme.id }}" class="back">
                            </path>
                        </svg>
                    </div>
                    <div id="Downvote_back{{ Meme.id }}" class="Downvote_back" style="position: absolute;top: 25%;right: 45%;">
                        <svg class="" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" width="100"
                             height="100" >
                            <path d="M 50.8 9 h 10 v 45 h 15 l -25 30 l -25 -30 h 15 v -45 h 15" fill="transparent"
                                  stroke-width="3" id="Downvote_move{{ Meme.id }}" class="back">
                            </path>
                        </svg>
                    </div>
                </div>
                <div class="card-content">
                    <img src="{{ Meme.op.userprofile.Profile_pic.url }}" class="profiles"
                         alt="{{ Meme.op.userprofile.Nick_Name }}">
                    <span class="OP">{{ Meme.op.userprofile.Nick_Name }}</span>
                    <span class="card-title activator white-text text"><span id="Title">{{ Meme.Title }}</span>
                        <span class="Cardcons right" id="Cmt_Count-{{ Meme.id }}">{{ Meme.comment_set.count }}</span>
                        <i class="Cardcons material-icons right" id="" onclick="UpdateComment({{ Meme.id }});
                        this.onclick=null;">comment
                        </i>
                    </span>
                {% if Meme.Pinned == '1' or Meme.Daily == '1' %}
                    <p>Upvotes not available on Admin Posts</p>
                {% else %}
                    <div class="move" id="move">
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" width="30" height="30"
                             fill="none" class="upvote" style="vertical-align: center"
                             onclick="Vote({{ Meme.id }},'Upvote', '{{ prpty|get_index:'0' }}')">
                            <path d=" M 49.4 8.5 l 25.8 30 h -15 v 46 h -20 v -46 h -15 l 26 -30"
                                  stroke="orangered"
                                        {% if prpty|get_index:"0" == 1 %}
                                            fill="orangered"
                                        {% endif %}
                                  fill="none" stroke-width="5" id="Upvote{{ Meme.id }}"></path>
                        </svg>
                        <span style="font-size: 20px;vertical-align: top;
                            {% if prpty|get_index:"1" == 1 %}
                                color: steelblue;
                            {% elif prpty|get_index:"0" == 1 %}
                                color: orangered;
                            {% endif %}
                                " id="Points{{ Meme.id }}">
                            {{ Meme.Points }}</span>
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" width="30" height="30"
                             fill="none" class="downvote"
                             onclick="Vote({{ Meme.id }},'Downvote', '{{ prpty|get_index:'0' }}')"
                             style="vertical-align: center">
                            <path class="downvote" d="M 50.8 9 h 10 v 45 h 15 l -25 30 l -25 -30 h 15 v -45 h 15"
                                stroke="steelblue"
                                    {% if prpty|get_index:"0" == 2 %}
                                        fill="steelblue"
                                    {% endif %}
                                stroke-width="5" id="Downvote{{ Meme.id }}"></path>
                        </svg>
                    </div>
                {% endif %}
                </div>
                <div class="card-reveal black">
                    <div class="card-header">
                        <span class="card-title white-text text">{{ Meme.Title }}<i onclick="clearInterval(Reload)"
                                class="material-icons right" style="margin: 1%">close</i></span>
                    </div>
                    <form method="post" class="Comment_Form" id="{{ Meme.id }}" name="{{ Meme.id }}"
                          onsubmit="Comment_Form('{{ Meme.id }}');return false;">
                        {% csrf_token %}
                        <div class="comment_builder" id="Comment-{{ Meme.id }}">{{ comment }}</div>
                        <button class="btn waves-effect waves-light btns" type="submit" value="{{ Meme.id }}"
                                id="The_Effing_Id-{{ Meme.id }}"
                                name="The_Effing_Id{{ Meme.id }}">Comment
                        </button>
                    </form>
                    <br>
                    <button class="btn waves-effect waves-light" type="button" name="action" style="border-radius: 50px;"
                            onclick="UpdateComment('{{ Meme.id }}')">View Comments
                        <i class="material-icons left">refresh</i>
                    </button>
                    <br>
                    <br>
                    <div id="Comment_List-{{ Meme.id }}" class="Comment_List">
                    </div>
                    <div class="progress" hidden id="Load_Bar_Comment_{{ Meme.id }}">
                        <div class="indeterminate"></div>
                    </div>
                </div>
            </div>
        {% endfor %}
        <a href="https://www.flaticon.com/free-icons/frog" title="frog icons">Frog icons created by Flat Icons - Flaticon</a>
    </div>
<script src="https://code.jquery.com/jquery-3.5.1.js"
        integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
        crossorigin="anonymous">
</script>
<script type="text/javascript">
    function getCookie(c_name) {
        if (document.cookie.length > 0) {
            c_start = document.cookie.indexOf(c_name + "=");
            if (c_start !== -1) {
                c_start = c_start + c_name.length + 1;
                c_end = document.cookie.indexOf(";", c_start);
                if (c_end === -1) c_end = document.cookie.length;
                return unescape(document.cookie.substring(c_start, c_end));
            }
        }
        return "";
    }

    function isEmpty(el) {
        return !$.trim(el.html())
    }

    function delay(delayInms) {
        return new Promise(resolve => {
            setTimeout(() => {
                resolve(2);
                }, delayInms);
            });
        }

    function Comment_Form(FormId) {
        $.ajaxSetup({
            headers: {"X-CSRFToken": getCookie("csrftoken")}
        });
        $.ajax({
            type: 'POST',
            url: {% url 'Home' %},
            dataType: 'json',
            async: true,
            data: JSON.stringify({
                'Act': 'Comment',
                'comment': $("#" + FormId).serialize(),
                'the_effing_id': FormId,
            }),
            complete: function () {
                UpdateComment(FormId);
                $("#Cmt_Count-" + FormId).load(
                    ('{% url "Comment_Update" identity=12345 %} #Cmt_Count-' + FormId).replace(/12345/, FormId.toString()))
            }
        });
    }

    function LineCorrector(Og_Id, CmntID, Cmnt_Chn, No, Rank, Cmnt_Chn_List, Operator) {
        const ReplyDiv = document.getElementById(Cmnt_Chn)
        const Lines = ReplyDiv.getElementsByClassName(`Rank-${Rank}`)
        const Ht = document.getElementById(`Reply_Form-${Cmnt_Chn}`).offsetHeight
        for (const Line of Lines) {
            if (Operator === "Plus") {
                Line.style.height = `${+(Line.offsetHeight) + Ht}px`
            } else {
                Line.style.height = `${+(Line.offsetHeight) - Ht}px`
            }
        }
        if (No !== '0') {
            let Rank_Num = +(document.getElementById(`Line_${Cmnt_Chn_List.join('-')}`).classList[2].split('-')[1])
            while (Cmnt_Chn_List.length >= 2) {
                const Og_No = document.getElementById(`Line_${Cmnt_Chn_List.join('-')}`).classList[1].split('-')[1]
                const MaxNo = document.getElementById(`No_${Cmnt_Chn_List.at(-2)}`).value
                const CmntDiv = document.getElementById(CmntID)
                for (let z = +(Og_No) + 1; z < +(MaxNo) + 1; z++) {
                    const More_Bloody_Lines = CmntDiv.getElementsByClassName(`No-${z} Rank-${Rank_Num}`)
                    for (const Line of More_Bloody_Lines) {
                        if (Operator === "Plus") {
                            Line.style.height = `${+(Line.offsetHeight) + Ht}px`
                        } else {
                            Line.style.height = `${+(Line.offsetHeight) - Ht}px`
                        }
                    }
                }
                Rank_Num -= 1
                Cmnt_Chn_List.pop()
            }
        }
    }

    function Reply(FormId, Cmnt_Chn, Rank, No, Og_Id, Cmnt_Chn_List) {
        const Reply = document.getElementById(`Reply_Form-${Cmnt_Chn}`)
        if (Reply !== null) {
            if (Reply.style.display === "none") {
                Reply.style.display = "block"
                LineCorrector(Og_Id, `Com_sec-${Og_Id}`, Cmnt_Chn, No, Rank, Cmnt_Chn_List, "Plus")
            } else {
                LineCorrector(Og_Id, `Com_sec-${Og_Id}`, Cmnt_Chn, No, Rank, Cmnt_Chn_List, "Minus")
                Reply.style.display = "none"
            }
        } else {
            const Div = document.getElementById(Cmnt_Chn)
            const Form = document.createElement('form')
            const Build = '' +
                '<div class="reply_builder" id="Comment-' + Cmnt_Chn + '">' +
                    '<textarea name="comment" required="" placeholder="Reply here" ' +
                        ' rows="10" maxlength="500" class="form-control"' +
                        `style="background-color:black;width:500px;border-radius: 10px" id="Reply-${Cmnt_Chn}">` +
                    '</textarea>' +
                '</div>'
            const Button = '<button class="btn waves-effect waves-light btns" type="submit">Comment</button>'
            Form.setAttribute('method', 'post')
            Form.setAttribute('class', 'Comment_Form')
            Form.setAttribute('id', `Reply_Form-${Cmnt_Chn}`)
            Form.setAttribute('onsubmit', 'Reply_Form(' + FormId + ', "' + Cmnt_Chn + '");return false;')
            Form.innerHTML = Build + Button
            Div.prepend(Form)
            LineCorrector(Og_Id, `Com_sec-${Og_Id}`, Cmnt_Chn, No, Rank, Cmnt_Chn_List, "Plus")
        }
    }

    function Reply_Form(FormId, Cmnt_Chn) {
        $.ajaxSetup({
            headers: {"X-CSRFToken": getCookie("csrftoken")}
        });
        $.ajax({
            type: 'POST',
            url: {% url 'Home' %},
            dataType: 'json',
            async: true,
            data:{
                'Act': 'Reply',
                'comment': document.getElementById("Reply-" + Cmnt_Chn).value,
                'the_effing_id': FormId,
                'Cmnt_Chn': Cmnt_Chn,
            },
            success: function (Reply_Id) {
                const Coll = document.getElementById(Cmnt_Chn)
                const ReplyBox = document.getElementById(`Reply_Form-${Cmnt_Chn}`)
                const Cnt = document.getElementById(`Reply-${Cmnt_Chn}`).innerText
                const Id = Cmnt_Chn.substr(0, Cmnt_Chn.length - 2).replace('+', '')
                const Num = Cmnt_Chn.substr(-2).replace('+', '')
                const Old_Id = Id.split("-")[(+(Num) - 1)]
                const Id_List = Id.split('-')
                const Og_Div_Ht = document.getElementById(`Comment_${Old_Id}`).offsetHeight
                const Line = document.createElement('div')
                const Cover_Div = document.createElement('div')
                Id_List.push(`${Reply_Id}`)
                const Og_Id = Id.split("-")[0]
                ReplyBox.innerHTML = ''
                let No_Checker = ''
                if (Coll.innerHTML === '') {
                    Coll.innerHTML = `<button hidden id="No_${Old_Id}" value="1"></button>`
                    No_Checker = document.getElementById(`No_${Old_Id}`)
                } else {
                    No_Checker = document.getElementById(`No_${Old_Id}`)
                    No_Checker.value = +(No_Checker.value) + 1
                }
                ReplyBox.innerHTML = '' +
                    `<p style="color: red;">Warning: This is a Place Holder Reply</p>` +
                    `<img src='{{ user.userprofile.Profile_pic.url }}' alt='${Reply_Id}' class='circle'>` +
                    "<span class='title'>{{ user.userprofile.Nick_Name }}</span>" +
                        `<p>${Cnt}</p>` +
                    `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" width="25" height="25"` +
                        `fill="none" class="Cmnt_Upvote"` +
                        `onclick="CmntVote(${Reply_Id}, 'Cmnt_Upvote', '0');return false;">` +
                            `<path d="M 49.4 8.5 l 25.8 30 h -15 v 46 h -20 v -46 h -15 l 26 -30" stroke="orangered"` +
                                `fill="none" stroke-width="5" class="Cmnt_Upvote_Icon" id="Upvote_${Reply_Id}">` +
                            `</path>` +
                    `</svg>` +
                    `<span class="Cmnt_Points">1</span>` +
                    `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" width="25" height="25"` +
                        `fill="none" class="downvote"` +
                        `onclick="CmntVote(${Reply_Id}, 'Cmnt_Downvote', '0');return false;">` +
                            `<path class="Cmnt_Downvote_Icon" d="M 50.8 9 h 10 v 45 h 15 l -25 30 l -25 -30 h 15 v -45 h 15"` +
                                `fill="none" stroke="steelblue" stroke-width="5" id="Downvote_${Reply_Id}">` +
                            `</path>` +
                    `</svg>` +
                    "<span class='Reply_Button'><i class='Reply_Icon small material-icons right'" +
                        `onclick='Reply(${FormId},"${Id}-${Reply_Id}+${(+(Num) + 1)}","${(+(Num) + 1)}"` +
                        `, ${No_Checker.value}, ${Og_Id}, [${Id_List}])'>reply</i>` +
                    `</span>`
                ReplyBox.setAttribute("class", "comment Reply")
                ReplyBox.setAttribute("id", `Comment_${Reply_Id}`)
                Cover_Div.setAttribute("id", `Comment_Cover-${Reply_Id}`)
                Cover_Div.appendChild(ReplyBox)
                Coll.appendChild(Cover_Div)
                Line.setAttribute("id", `Line_${Id}-${Reply_Id}`)
                const New_Ht = document.getElementById(`Comment_Cover-${Reply_Id}`).offsetHeight
                if (['6', '7', '8', '9',].includes(Num.substr(-1))) {
                    Coll.style.right = '20px'
                    Line.setAttribute("class", `anti-line No-${No_Checker.value} Rank-${Num}`)
                } else {
                    Coll.style.left = '20px'
                    Line.setAttribute("class", `line No-${No_Checker.value} Rank-${Num}`)
                }
                Line.setAttribute("style",
                    `top: -${Og_Div_Ht * 0.5}px;height: ${(Og_Div_Ht * 0.5) + Coll.offsetHeight - (New_Ht * 0.5)}px;`)
                ReplyBox.innerHTML += `<div class="comment_section" id="${Id}-${Reply_Id}+${(+(Num) + 1)}"></div>`
                Cover_Div.appendChild(Line)
            }
        });
    }

    function Ring_Form(Ring_ID, clr) {
        $.ajaxSetup({
            headers: {"X-CSRFToken": getCookie("csrftoken")}
        });
        $.ajax({
            type: 'POST',
            url: {% url 'Home' %},
            dataType: 'json',
            async : true,
            data:{
                'Act': 'Ring_Send',
                'Cnt': document.getElementById(`Ring_Txt_${Ring_ID}`).value,
                'Id': Ring_ID,
                'Color': clr,
            },
            success: function (data) {
                alert(data)
            }
        });
    }

    function Msg_Edit_Form(Msg_ID) {
        $.ajaxSetup({
            headers: {"X-CSRFToken": getCookie("csrftoken")}
        });
        $.ajax({
            type: 'POST',
            url: {% url 'Home' %},
            dataType: 'json',
            async : true,
            data:{
                'Act': 'Msg_Edit',
                'Cnt': document.getElementById(`Edit_Msg_${Msg_ID}`).value,
                'Id': Msg_ID,
            },
        });
        document.getElementById(`Msg_Cnt_${Msg_ID}`).innerHTML = `<div class="preloader-wrapper active">` +
            `<div class="spinner-layer spinner-only" style="color: blue"><div class="circle-clipper left">` +
            `<div class="circle"></div></div><div class="gap-patch"><div class="circle"></div>` +
            `</div><div class="circle-clipper right"><div class="circle"></div></div></div></div>`
    }

    function Ring_Reply_Form(Ring_ID, Reply_ID, clr) {
        alert('Working ?!')
        $.ajaxSetup({
            headers: {"X-CSRFToken": getCookie("csrftoken")}
        });
        $.ajax({
            type: 'POST',
            url: {% url 'Home' %},
            dataType: 'json',
            async : true,
            data:{
                'Act': 'Ring_Reply',
                'Cnt': document.getElementById(`Ring_Txt_${Ring_ID}`).value,
                'Id': Ring_ID,
                'Reply_ID': Reply_ID,
                'Color': clr,
            },
        });
    }

    function UpdateComment(FormId) {
        const id = $("#Comment_List-" + FormId)
        const load_bar = $("#Load_Bar_Comment_" + FormId)
        id.empty()
        load_bar.show()
        id.load(`{% url "Comment_Update" identity=69420 %}`.replace(/69420/, FormId.toString())
            , function () {
                load_bar.hide()
        });
    }

    {% comment %}
    Used to set interval of a duration of 1 to provide live measagging
    Uses value from invisible button and verifies it in backend
    {% endcomment %}
    function Start_Ring(Ring_ID) {
        Reload = setInterval(function () {
            var Len = document.getElementById(`Len_Msgs_${Ring_ID}`).value
            var Edit = document.getElementById(`Len_Edit_${Ring_ID}`).value
            $.ajax({
                type: 'GET',
                url: "/ring/1/" + Len + "/" + Edit + "/" + Ring_ID,
                success: function (data) {
                    const List = JSON.parse(data)
                    if (List['New'] === 1) {
                        for (var I in List['New_Msgs']) {
                            const Ring_Msg = document.getElementById('Ring_Msg_' + Ring_ID)
                            var Msg = List['New_Msgs'][I]
                            var Div = document.createElement('div')
                            var Side_Menu = document.createElement('div')
                            Div.setAttribute('class', 'Msg')
                            Div.setAttribute('id', 'Msg_' + Msg[0])
                            if (Msg[4] === '0') {
                                Div.setAttribute('style', 'float: left')
                                Div.innerHTML = `<img src="${Msg[2]}" alt="${Msg[1]}" class="Pic" style="float: left">` +
                                    `<div class="Name" style="color: red;">${Msg[1]}</div><br>`
                                if (Msg[8] !== '0') {
                                    Div.innerHTML += `<div class="Msg_Reply" id="Msg_Reply_${Msg[0]}"` +
                                        `style="border-left: 4px double ${Msg[10]};margin-bottom: -10px">` +
                                        `<p>${Msg[9]}</p>`.replace(/\n/, '<br>') + `</div>`
                                }
                                Div.innerHTML +=`<div class="Msg_Txt" id="Msg_Cnt_${Msg[0]}" style="background:` +
                                    `linear-gradient(to top left, rgba(220, 4, 20, 0.5) 1%,{{ theme.Body_Back }} 30%);` +
                                    `border: 2px solid red;float: left">` +
                                    `<div class="Msg_${Msg[0]}" id="Msg_0_${Msg[0]}">` +
                                    `<p>${Msg[3].replace(/\n/, '<br>')}</p>` +
                                    `</div></div>`
                                Side_Menu.setAttribute('class', 'Side_Menu')
                                Side_Menu.setAttribute('id', `Side_Menu_${Msg[0]}`)
                                Side_Menu.setAttribute('style', 'float: left')
                                if (Msg[7] === {{ user.id }}) {alert('works1')}
                                if (Msg[5] === '0') {alert('works2')}
                                if (Msg[7] === {{ user.id }} && Msg[5] === '0') {
                                    Side_Menu.innerHTML += `<i class="Edit_Btn material-icons" onclick="Msg_Edit(${Msg[0]}, 'Red', 0)"` +
                                        `style="color: red;float: left">edit</i>` +
                                        `<div class="Side_Border" style="border-left: 2px solid red"></div>`
                                } else if (Msg[8] === {{ user.id }} && Msg[5] === '1') {
                                    Side_Menu.innerHTML += `<i class="Edit_Btn material-icons" ` +
                                        `onclick="Msg_Edit(${Msg[0]}, 'Red', 1)" style="color: red;float: left">edit</i>` +
                                        `<div class="Side_Border" style="border-left: 2px solid red"></div>`
                                }
                                Side_Menu.innerHTML += `<i class="Rely_Btn material-icons" style="color: red;">reply</i>`
                            } else if (Msg[4] === '1') {
                                Div.setAttribute('style', 'float: right')
                                Div.innerHTML = `<div style="float: right;">` +
                                    `<div class="Name" style="color: blue;">${Msg[1]}</div>` +
                                    `<img src="${Msg[2]}" alt="${Msg[1]}" class="Pic" style="float: left"></div><br>`
                                if (Msg[8] !== '0') {
                                    Div.innerHTML += `<div class="Msg_Reply" id="Msg_Reply_${Msg[0]}"` +
                                        `style="border-right: 4px double ${Msg[10]};left: -83%;margin-bottom: -30px">` +
                                        `<p>${Msg[9]}</p>`.replace(/\n/, '<br>') + `</div><br>`
                                }
                                Div.innerHTML += `<div class="Msg_Txt" id="Msg_Cnt_${Msg[0]}" style="background:` +
                                    `linear-gradient(to top left, rgba(22, 1, 178, 0.5) 1%,{{ theme.Body_Back }} 30%);` +
                                    `border: 2px solid blue;float: right">` +
                                    `<div class="Msg_${Msg[0]}" id="Msg_0_${Msg[0]}">` +
                                    `<p>${Msg[3].replace(/\n/, '<br>')}</p>` +
                                    `</div></div>`
                                Side_Menu.setAttribute('class', 'Side_Menu')
                                Side_Menu.setAttribute('id', `Side_Menu_${Msg[0]}`)
                                Side_Menu.setAttribute('style', 'float: right')
                                Side_Menu.innerHTML +=
                                    `<i class="Rely_Btn material-icons" style="color: blue;transform: scaleX(-1)">reply</i>`
                                if (Msg[8] === {{ user.id }} && Msg[5] === '0') {
                                    Side_Menu.innerHTML +=
                                        `<div class="Side_Border" style="border-left: 2px solid blue"></div>` +
                                        `<i class="Edit_Btn material-icons" onclick="Msg_Edit(${Msg[0]}, 'Blue', 0)"` +
                                        `style="color: blue;float: right;transform: scaleX(-1)">edit</i>`
                                } else if (Msg[8] === {{ user.id }} && Msg[5] === '1') {
                                    Side_Menu.innerHTML +=
                                        `<div class="Side_Border" style="border-left: 2px solid blue"></div>` +
                                        `<i class="Edit_Btn material-icons" ` +
                                        `onclick="Msg_Edit(${Msg[0]}, 'Blue', 1)" ` +
                                        `style="color: blue;float: right;transform: scaleX(-1)">edit</i>`
                                }
                            }
                            Div.appendChild(Side_Menu)
                            Ring_Msg.appendChild(Div)
                        }
                        document.getElementById('Len_Msgs_' + Ring_ID).value = List['Len']
                    }
                    if (List['Edit'] === 1) {
                        for (var Z in List['Edit_Msgs']) {
                            var Edit = List['Edit_Msgs'][Z]
                            var Cnt = document.getElementById(`Msg_Cnt_${Edit[0]}`)
                            Cnt.innerHTML = ''
                            if (Edit[4] === '0') {
                                if (Edit[5] === '2') {
                                    Cnt.innerHTML = `<div class="Msg_0" id="Msg_0_${Edit[0]}"` +
                                        `style="display: none"><p>${Edit[3].replace(/\n/, '<br>')}</p></div>` +
                                        `<div class="Msg_1" id="Msg_1_${Edit[0]}" style="display: none">` +
                                        `<p>${Edit[6].replace(/\n/, '<br>')}</p></div>` +
                                        `<div class="Msg_2" id="Msg_2_${Edit[0]}"><p>${Edit[7].replace(/\n/, '<br>')}</p></div>` +
                                        `<div class="Slider_Btns"><i class="Dot material-icons" id="Dot_${Edit[0]}"` +
                                        `onclick="ChangeCnt(${Edit[0]}, 0, 2, this)"style="--clr: red">fiber_manual_record` +
                                        `</i><i class="Dot material-icons" id="Dot_${Edit[0]}"` +
                                        `onclick="ChangeCnt(${Edit[0]}, 1, 2, this)" style="--clr: red">fiber_manual_record` +
                                        `</i><i class="Dot_Active material-icons" id="Dot_${Edit[0]}_Active"` +
                                        `onclick="ChangeCnt(${Edit[0]}, 2, 2, this)"style="--clr: red">fiber_manual_record` +
                                        `</i></div>`
                                } else if (Edit[5] === '1') {
                                    Cnt = document.getElementById(`Msg_Cnt_${Edit[0]}`)
                                    Cnt.innerHTML = `<div class="Msg_0" id="Msg_0_${Edit[0]}"` +
                                        `style="display: none"><p>${Edit[3].replace(/\n/, '<br>')}</p></div>` +
                                        `<div class="Msg_1" id="Msg_1_${Edit[0]}"><p>${Edit[6].replace(/\n/, '<br>')}</p></div>` +
                                        `<div class="Slider_Btns"><i class="Dot material-icons" id="Dot_${Edit[0]}"` +
                                        `onclick="ChangeCnt(${Edit[0]}, 0, 1, this)" style="--clr: red">fiber_manual_record` +
                                        `</i><i class="Dot_Active material-icons" id="Dot_${Edit[0]}_Active"` +
                                        `onclick="ChangeCnt(${Edit[0]}, 1, 1, this)" style="--clr: red">fiber_manual_record` +
                                        `</i></div>`
                                }
                            } else if (Edit[4] === '1') {
                                if (Edit[5] === '2') {
                                    Cnt.innerHTML = `<div class="Msg_0" id="Msg_0_${Edit[0]}"` +
                                        `style="display: none"><p>${Edit[3].replace(/\n/, '<br>')}</p></div>` +
                                        `<div class="Msg_1" id="Msg_1_${Edit[0]}" style="display: none">` +
                                        `<p>${Edit[6].replace(/\n/, '<br>')}</p></div>` +
                                        `<div class="Msg_2" id="Msg_2_${Edit[0]}">` +
                                        `<p>${Edit[7].replace(/\n/, '<br>')}</p></div>` +
                                        `<div class="Slider_Btns">` +
                                        `<i class="Dot_Active material-icons" id="Dot_${Edit[0]}_Active"` +
                                        `onclick="ChangeCnt(${Edit[0]}, 2, 2, this)"style="--clr: blue">` +
                                        `fiber_manual_record</i><i class="Dot material-icons" id="Dot_${Edit[0]}"` +
                                        `onclick="ChangeCnt(${Edit[0]}, 1, 2, this)" style="--clr: blue">` +
                                        `fiber_manual_record</i><i class="Dot material-icons" id="Dot_${Edit[0]}"` +
                                        `onclick="ChangeCnt(${Edit[0]}, 0, 2, this)"style="--clr: blue">` +
                                        `fiber_manual_record</i></div>`
                                } else if (Edit[5] === '1') {
                                    Cnt = document.getElementById(`Msg_Cnt_${Edit[0]}`)
                                    Cnt.innerHTML = `<div class="Msg_0" id="Msg_0_${Edit[0]}"` +
                                        `style="display: none"><p>${Edit[3].replace(/\n/, '<br>')}</p></div>` +
                                        `<div class="Msg_1" id="Msg_1_${Edit[0]}">` +
                                        `<p>${Edit[6].replace(/\n/, '<br>')}</p></div>` +
                                        `<div class="Slider_Btns">` +
                                        `<i class="Dot_Active material-icons" id="Dot_${Edit[0]}_Active"` +
                                        `onclick="ChangeCnt(${Edit[0]}, 1, 1, this)" style="--clr: blue">` +
                                        `fiber_manual_record</i><i class="Dot material-icons" id="Dot_${Edit[0]}"` +
                                        `onclick="ChangeCnt(${Edit[0]}, 0, 1, this)" style="--clr: blue">` +
                                        `fiber_manual_record</i></div>`
                                }
                            }
                            document.getElementById(`Side_Menu_${Edit[0]}`).style.display = 'block'
                        }
                        document.getElementById(`Len_Edit_${Ring_ID}`).value = List['Edit_Len']
                    }
                },
                error: function () {
                    alert('An error occured')
                }
            });
        }, 3000);
    }

    function Show_Ring(Ring_ID) {
        const id = $("#Ring_Initial_" + Ring_ID)
        id.empty()
        id.load('{% url "Ring" reload=0 len_msgs=69 edit_msgs=69 ring_id=69420 %}'.replace(/69420/, Ring_ID.toString()),
            function () {
                const ring = document.getElementById('Ring_' + Ring_ID)
                ring.scrollTop = ring.scrollHeight
                Start_Ring(Ring_ID)
            });
    }

    function Vote(MemeID, VoteType, VotePrpty) {
        const Meme = document.getElementById("Meme" + MemeID)
        const points = document.getElementById("Points" + MemeID)
        if(VoteType === 'Upvote' ) {
            const upvote = document.getElementById("Upvote" + MemeID)
            Meme.style.borderColor = "orangered"
            if (VotePrpty === '0' || VotePrpty === '3') {
                Animate(MemeID,VoteType,'Orangered');
                upvote.style.fill = "orangered";
                upvote.style.stroke = "orangered";
                points.textContent = +(points.textContent) + 1;
                points.style.color = "orangered"
            } else if(VotePrpty === '1') {
                upvote.style.fill = "transparent";
                points.textContent = +(points.textContent) - 1;
                points.style.color = "lightgrey"
            } else if(VotePrpty === '2') {
                Animate(MemeID,VoteType,'Orangered');
                upvote.style.fill = "orangered";
                upvote.style.stroke = "orangered";
                points.style.color = "orangered"
                document.getElementById("Downvote" + MemeID).style.fill = "transparent"
                points.textContent = +(points.textContent) + 2;
            }
        } else if (VoteType === 'Downvote') {
            const downvote = document.getElementById("Downvote" + MemeID)
            Meme.style.borderColor = "steelblue"
            if(VotePrpty === '0' || VotePrpty === '3') {
                Animate(MemeID,VoteType,'Steelblue');
                downvote.style.fill = "steelblue";
                downvote.style.stroke = "steelblue";
                points.textContent = +(points.textContent) - 1;
                points.style.color = "steelblue"
            } else if(VotePrpty === '1') {
                Animate(MemeID,VoteType,'Steelblue');
                downvote.style.fill = "steelblue";
                downvote.style.stroke = "steelblue";
                points.style.color = "steelblue"
                document.getElementById("Upvote" + MemeID).style.fill = "transparent"
                points.textContent = +(points.textContent) - 2;
            } else if(VotePrpty === '2') {
                downvote.style.fill = "transparent";
                points.textContent = +(points.textContent) + 1;
                points.style.color = "lightgrey"
            }
        }
        $.ajaxSetup({
            headers: {"X-CSRFToken": getCookie("csrftoken")}
        });
        $.ajax({
            type: "POST",
            url: "{% url "Home" %}",
            data: {
                "Id" : MemeID,
                "Act": VoteType,
            },
            dataType: "json",
        })
    }

    function PlayGif(ID, Meme_url) {
        const Gif = document.getElementById('Gif_' + ID)
        const OG_Src = Gif.src;
        if (OG_Src === '{{ Static_Gif }}') {
            Gif.src = Meme_url;
        } else {
            Gif.src = '{{ Static_Gif }}'
        }
    }

    function Play (MemeID) {
        const Vid = document.getElementById('Video_' + MemeID)
        if (Vid.paused) {
            alert('Play')
            document.getElementById('Play_' + MemeID).style.display = 'none'
            document.getElementById('Pause_' + MemeID).style.display = 'block'
            document.getElementById('Play_Nav_' + MemeID).style.display = 'none'
            document.getElementById('Pause_Nav_' + MemeID).style.display = 'block'
            $("#Middle_Menu_" + MemeID).fadeIn();
            Vid.play()
            ProgressLoop(MemeID)
        } else {
            alert('Pause')
            document.getElementById('Play_' + MemeID).style.display = 'block'
            document.getElementById('Pause_' + MemeID).style.display = 'none'
            document.getElementById('Play_Nav_' + MemeID).style.display = 'block'
            document.getElementById('Pause_Nav_' + MemeID).style.display = 'none'
            $("#Middle_Menu_" + MemeID).fadeIn();
            Vid.pause()
        }
    }

    function LinkCopy(MemeID) {
        const Link = document.getElementById('Src_Getter_' + MemeID)
        Link.select();
        Link.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(Link.value)
        M.toast({html: 'Link Copied!',timeRemaining: 0})
    }

    function Full_Scrn (MemeID) {
        const Vid = document.getElementById('Video_' + MemeID)
        Vid.requestFullscreen()
    }

    function Forward(MemeID) {
        const Vid = document.getElementById('Video_' + MemeID)
        Vid.currentTime += 5
        clearTimeout(Time);
    }

    function Rewind(MemeID) {
        const Vid = document.getElementById('Video_' + MemeID)
        Vid.currentTime -= 5
        clearTimeout(Time);
    }
    function ProgressLoop(MemeID) {
        const Vid = document.getElementById('Video_' + MemeID)
        const Progress = document.getElementById('Progress_' + MemeID)
         setInterval(function () {
             Progress.value = Math.round((Vid.currentTime / Vid.duration) * 100);
        });
    }

    async function Animate(MemeID, VoteType, Color) {
        const target = document.getElementById(VoteType + "_back" + MemeID);
        const fill = document.getElementById(VoteType + "_move" + MemeID)
        fill.style.fill = Color
        fill.style.stroke = Color
        target.className = "animate_" + VoteType
        let delayres = await delay(1500);
        target.className = VoteType + "_back" + MemeID
        fill.style.fill = "none"
        fill.style.stroke = "none"
    }

    var elem = document.querySelector('.sidenav');
    var instance = new M.Sidenav(elem);

    $(document).ready(function () {
        $(".Vid").each(function () {
            const ID = this.id.slice(4)
            var Time = null;
            $("#Vid_" + ID).mousemove(function() {
                clearTimeout(Time);
                $("#Middle_Menu_" + ID).fadeIn();
                $("#Bottom_Menu_" + ID).fadeIn();
                Time = setTimeout(function () {
                    $("#Middle_Menu_" + ID).fadeOut();
                    $("#Bottom_Menu_" + ID).fadeOut();
                }, 1500);
            }).mouseleave(function() {
                clearTimeout(Time);
                $("#Middle_Menu_" + ID).hide();
                $("#Bottom_Menu_" + ID).hide();
            });
            const Progress = document.getElementById("Progress_" + ID)
            const Vid = document.getElementById("Video_" + ID)
            Progress.addEventListener('click', (e) => {
                Vid.currentTime = (e.offsetX / Progress.offsetWidth) * Vid.duration
                ProgressLoop(ID)
    })
        })
        $('.sidenav').sidenav();
    });
</script>
</body>
</html>